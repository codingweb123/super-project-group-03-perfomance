{"version":3,"file":"books-qPu3kskt.js","sources":["../../src/js/books.js"],"sourcesContent":["import iziToast from \"izitoast\"\nimport \"izitoast/dist/css/iziToast.min.css\"\nimport { refs } from \"./refs\"\nimport { getBooksByCategory, getCategoryList, getTopBooks } from \"./api\"\nimport { loadBookModal } from \"./book-modal\"\nimport { ScrollTrigger } from \"gsap/ScrollTrigger\"\n\nconst { books } = refs\n\nconst booksList = books.querySelector(\".books-list\")\nconst categoryBtn = books.querySelector(\".categories-btn\")\nconst categories = books.querySelector(\".categories\")\n\nconst isMobile = () => {\n\treturn !matchMedia(\"(hover: hover)\").matches\n}\nconst numberToPaginate = () => {\n\treturn isMobile() ? 10 : 24\n}\nconst paginationNumber = 4\nconst paginationNum = document.querySelector(\".pagination-number\")\nconst moreButton = document.querySelector(\".btn.more\")\nconst paginationCount = document.querySelector(\".pagination-all\")\n\nconst showLoadingMore = () => {\n\tmoreButton.classList.remove(\"visually-hidden\")\n}\nconst hideLoadingMore = () => {\n\tmoreButton.classList.add(\"visually-hidden\")\n}\n\nconst renderBooks = books => {\n\tbooksList.innerHTML = books.reduce(\n\t\t(a, { _id, book_image, title, price, author }) =>\n\t\t\t(a += `\n\t\t\t\t<li>\n\t\t\t\t<img\n\t\t\t\tsrc=\"${book_image}\"\n\t\t\t\tloading=\"lazy\"\n\t\t\t\talt=\"${title}\"\n\t\t\t\t/>\n\t\t\t\t<h3><b>${title}</b><span class=\"price\">$${price}</span></h3>\n\t\t\t\t<p class=\"author\">${author}</p>\n\t\t\t\t<button class=\"btn\" data-bookid=\"${_id}\">Learn More</button>\n\t\t\t\t</li>`),\n\t\t\"\"\n\t)\n\tScrollTrigger.refresh()\n}\nconst renderNewBooks = books => {\n\tbooksList.innerHTML += books.reduce(\n\t\t(a, { _id, book_image, title, price, author }) =>\n\t\t\t(a += `\n    <li>\n        <img\n            src=\"${book_image}\"\n\t\t\tloading=\"lazy\"\n            alt=\"${title}\"\n        />\n        <h3><b>${title}</b><span class=\"price\">$${price}</span></h3>\n        <p class=\"author\">${author}</p>\n        <button class=\"btn\" data-bookid=\"${_id}\">Learn More</button>\n    </li>`),\n\t\t\"\"\n\t)\n}\nconst sliceBooksByPage = (books, page = 0) => {\n\treturn books.slice(page * paginationNumber, (page + 1) * paginationNumber)\n}\nconst sliceFirstBooksByPage = (books, page = 0) => {\n\treturn books.slice(page * numberToPaginate(), (page + 1) * numberToPaginate())\n}\nconst setPaginationNumber = (books, value) => {\n\tpaginationNum.textContent =\n\t\tbooks.length < value ? books.length.toString() : value.toString()\n}\nconst setPaginationCount = value => {\n\tpaginationCount.textContent = value.toString()\n}\nconst renderLoadingBooks = () => {\n\tbooksList.innerHTML = [0, 0, 0, 0].reduce(\n\t\t(a, _) =>\n\t\t\t(a += `\n    <li>\n        <img\n\t\t    src=\"data:image/gif;base64,R0lGODlhAQABAAAAACw=\"\n            class=\"loading\"\n            alt=\"\"\n        />\n        <h3><b class=\"loading\">................................................</b><span class=\"price loading\">............</span></h3>\n        <p class=\"author loading\">............... ............</p>\n        <button class=\"btn\" disabled>Learn More</button>\n    </li>`),\n\t\t\"\"\n\t)\n}\n\nconst renderLoadingTexts = element => {\n\tfor (let i = 0; i < 15; i++) {\n\t\telement.innerHTML += `<li class=\"loading\">........................................................................................</li>`\n\t}\n}\nconst removeRenderLoading = element => {\n\telement.querySelectorAll(\".loading\").forEach(i => i.remove())\n}\n\nlet renderedBooks = []\nlet page = 0\n\nconst renderTopBooks = async () => {\n\trenderedBooks = []\n\tpage = 0\n\thideLoadingMore()\n\tgetTopBooks()\n\t\t.then(data => {\n\t\t\tremoveRenderLoading(booksList)\n\t\t\tdata.forEach(category => renderedBooks.push(...category.books))\n\t\t\trenderBooks(sliceFirstBooksByPage(renderedBooks))\n\t\t\tpage += 1\n\t\t\tif (renderedBooks.length > numberToPaginate()) {\n\t\t\t\tshowLoadingMore()\n\t\t\t}\n\t\t\tsetPaginationNumber(renderedBooks, numberToPaginate())\n\t\t\tsetPaginationCount(renderedBooks.length)\n\t\t})\n\t\t.catch(() => {\n\t\t\tiziToast.error({\n\t\t\t\tmessage: \"Error while getting data from all categories!\",\n\t\t\t})\n\t\t})\n}\n\nrenderLoadingTexts(categories)\nsetTimeout(async () => {\n\tgetCategoryList()\n\t\t.then(data => {\n\t\t\tremoveRenderLoading(categories)\n\t\t\tcategories.innerHTML += data.reduce(\n\t\t\t\t(acc, { list_name }) => (acc += !list_name ? \"\" : `<li>${list_name}`),\n\t\t\t\t\"\"\n\t\t\t)\n\t\t})\n\t\t.catch(() => {\n\t\t\tiziToast.error({ message: \"Error while getting data from categories!\" })\n\t\t})\n\ttry {\n\t\tawait renderTopBooks()\n\t} catch {\n\t\tiziToast.error({ message: \"Error while getting books data!\" })\n\t}\n}, 1000)\n\ncategoryBtn.addEventListener(\"click\", () => {\n\tcategories.classList.toggle(\"active\")\n})\n\ncategories.addEventListener(\"click\", async e => {\n\tif (\n\t\te.target === e.currentTarget ||\n\t\t!e.target ||\n\t\te.target.classList.contains(\"active\")\n\t) {\n\t\treturn\n\t}\n\tcategories\n\t\t.querySelectorAll(\"li.active\")\n\t\t.forEach(item => item.classList.remove(\"active\"))\n\te.target.classList.add(\"active\")\n\tconst category = e.target.textContent\n\tcategoryBtn.textContent = category\n\tcategories.classList.remove(\"active\")\n\trenderLoadingBooks()\n\thideLoadingMore()\n\tif (e.target.dataset.value === \"all\") {\n\t\tawait renderTopBooks()\n\t\treturn\n\t}\n\trenderedBooks = []\n\tpage = 0\n\tgetBooksByCategory(category)\n\t\t.then(data => {\n\t\t\trenderedBooks = data\n\t\t\trenderBooks(sliceFirstBooksByPage(data))\n\t\t\tpage += 1\n\t\t\tif (data.length > numberToPaginate()) {\n\t\t\t\tshowLoadingMore()\n\t\t\t}\n\t\t\tsetPaginationNumber(data, numberToPaginate())\n\t\t\tsetPaginationCount(data.length)\n\t\t})\n\t\t.catch(() => {\n\t\t\tiziToast.error({\n\t\t\t\tmessage: \"Error while getting data from category!\",\n\t\t\t})\n\t\t})\n\t\t.finally(() => removeRenderLoading(booksList))\n})\n\nmoreButton.addEventListener(\"click\", e => {\n\te.preventDefault()\n\tmoreButton.disabled = true\n\tconst alreadyShown = numberToPaginate() + page * paginationNumber\n\tconst remaining = renderedBooks.length - alreadyShown\n\tif (remaining > 0) {\n\t\tconst slice = sliceBooksByPage(renderedBooks, page)\n\t\trenderNewBooks(slice)\n\n\t\tpage++\n\n\t\tconst newShown = alreadyShown + slice.length\n\t\tsetPaginationNumber(renderedBooks, newShown)\n\n\t\tif (newShown >= renderedBooks.length) {\n\t\t\thideLoadingMore()\n\t\t\tiziToast.success({\n\t\t\t\tposition: \"bottomRight\",\n\t\t\t\tmessage: \"This is the last page of books for you :)\",\n\t\t\t\tcolor: \"#fff\",\n\t\t\t})\n\t\t}\n\n\t\tmoreButton.disabled = false\n\t} else {\n\t\tiziToast.error({\n\t\t\tmessage: \"You already loaded all books from that category!\",\n\t\t})\n\t}\n})\n\nbooksList.addEventListener(\"click\", async e => {\n\tif (e.target.nodeName != \"BUTTON\" || e.target.classList != \"btn\") {\n\t\treturn\n\t}\n\tawait loadBookModal(e.target.dataset.bookid)\n})\n"],"names":["books","refs","booksList","categoryBtn","categories","isMobile","numberToPaginate","paginationNumber","paginationNum","moreButton","paginationCount","showLoadingMore","hideLoadingMore","renderBooks","a","_id","book_image","title","price","author","ScrollTrigger","renderNewBooks","sliceBooksByPage","page","sliceFirstBooksByPage","setPaginationNumber","value","setPaginationCount","renderLoadingBooks","_","renderLoadingTexts","element","i","removeRenderLoading","renderedBooks","renderTopBooks","getTopBooks","data","category","iziToast","getCategoryList","acc","list_name","item","getBooksByCategory","alreadyShown","slice","newShown","loadBookModal"],"mappings":"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"}