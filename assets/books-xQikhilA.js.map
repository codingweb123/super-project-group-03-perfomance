{"version":3,"file":"books-xQikhilA.js","sources":["../../src/js/books.js"],"sourcesContent":["import iziToast from \"izitoast\"\nimport \"izitoast/dist/css/iziToast.min.css\"\nimport { refs } from \"./refs\"\nimport { getBooksByCategory, getCategoryList, getTopBooks } from \"./api\"\nimport { loadBookModal } from \"./book-modal\"\n\nconst { books } = refs\n\nconst booksList = books.querySelector(\".books-list\")\nconst categoryBtn = books.querySelector(\".categories-btn\")\nconst categories = books.querySelector(\".categories\")\n\nconst isMobile = () => {\n\treturn !matchMedia(\"(hover: hover)\").matches\n}\nconst numberToPaginate = () => {\n\treturn isMobile() ? 10 : 24\n}\nconst paginationNumber = 4\nconst paginationNum = document.querySelector(\".pagination-number\")\nconst moreButton = document.querySelector(\".btn.more\")\nconst paginationCount = document.querySelector(\".pagination-all\")\n\nconst showLoadingMore = () => {\n\tmoreButton.classList.remove(\"visually-hidden\")\n}\nconst hideLoadingMore = () => {\n\tmoreButton.classList.add(\"visually-hidden\")\n}\n\nconst renderBooks = books => {\n\tbooksList.innerHTML = books.reduce(\n\t\t(a, { _id, book_image, title, price, author }) =>\n\t\t\t(a += `\n    <li>\n        <img\n            src=\"${book_image}\"\n\t\t\tloading=\"lazy\"\n            alt=\"${title}\"\n        />\n        <h3><b>${title}</b><span class=\"price\">$${price}</span></h3>\n        <p class=\"author\">${author}</p>\n        <button class=\"btn\" data-bookid=\"${_id}\">Learn More</button>\n    </li>`),\n\t\t\"\"\n\t)\n}\nconst renderNewBooks = books => {\n\tbooksList.innerHTML += books.reduce(\n\t\t(a, { _id, book_image, title, price, author }) =>\n\t\t\t(a += `\n    <li>\n        <img\n            src=\"${book_image}\"\n\t\t\tloading=\"lazy\"\n            alt=\"${title}\"\n        />\n        <h3><b>${title}</b><span class=\"price\">$${price}</span></h3>\n        <p class=\"author\">${author}</p>\n        <button class=\"btn\" data-bookid=\"${_id}\">Learn More</button>\n    </li>`),\n\t\t\"\"\n\t)\n}\nconst sliceBooksByPage = (books, page = 0) => {\n\treturn books.slice(page * paginationNumber, (page + 1) * paginationNumber)\n}\nconst sliceFirstBooksByPage = (books, page = 0) => {\n\treturn books.slice(page * numberToPaginate(), (page + 1) * numberToPaginate())\n}\nconst setPaginationNumber = (books, value) => {\n\tconsole.log(paginationNum.textContent)\n\tpaginationNum.textContent =\n\t\tbooks.length < value ? books.length.toString() : value.toString()\n}\nconst setPaginationCount = value => {\n\tpaginationCount.textContent = value.toString()\n}\nconst renderLoadingBooks = () => {\n\tbooksList.innerHTML = [0, 0, 0, 0].reduce(\n\t\t(a, _) =>\n\t\t\t(a += `\n    <li>\n        <img\n\t\t    src=\"data:image/gif;base64,R0lGODlhAQABAAAAACw=\"\n            class=\"loading\"\n            alt=\"\"\n        />\n        <h3><b class=\"loading\">................................................</b><span class=\"price loading\">............</span></h3>\n        <p class=\"author loading\">............... ............</p>\n        <button class=\"btn\" disabled>Learn More</button>\n    </li>`),\n\t\t\"\"\n\t)\n}\n\nconst renderLoadingTexts = element => {\n\tfor (let i = 0; i < 15; i++) {\n\t\telement.innerHTML += `<li class=\"loading\">........................................................................................</li>`\n\t}\n}\nconst removeRenderLoading = element => {\n\telement.querySelectorAll(\".loading\").forEach(i => i.remove())\n}\n\nlet renderedBooks = []\nlet page = 0\n\nconst renderTopBooks = async () => {\n\trenderedBooks = []\n\tpage = 0\n\thideLoadingMore()\n\tgetTopBooks()\n\t\t.then(data => {\n\t\t\tremoveRenderLoading(booksList)\n\t\t\tdata.forEach(category => renderedBooks.push(...category.books))\n\t\t\trenderBooks(sliceFirstBooksByPage(renderedBooks))\n\t\t\tpage += 1\n\t\t\tif (renderedBooks.length > numberToPaginate()) {\n\t\t\t\tshowLoadingMore()\n\t\t\t}\n\t\t\tsetPaginationNumber(renderedBooks, numberToPaginate())\n\t\t\tsetPaginationCount(renderedBooks.length)\n\t\t})\n\t\t.catch(() => {\n\t\t\tiziToast.error({\n\t\t\t\tmessage: \"Error while getting data from all categories!\",\n\t\t\t})\n\t\t})\n}\n\ndocument.addEventListener(\"DOMContentLoaded\", async () => {\n\trenderLoadingTexts(categories)\n\tsetTimeout(async () => {\n\t\tgetCategoryList()\n\t\t\t.then(data => {\n\t\t\t\tremoveRenderLoading(categories)\n\t\t\t\tcategories.innerHTML += data.reduce(\n\t\t\t\t\t(acc, { list_name }) => (acc += !list_name ? \"\" : `<li>${list_name}`),\n\t\t\t\t\t\"\"\n\t\t\t\t)\n\t\t\t})\n\t\t\t.catch(() => {\n\t\t\t\tiziToast.error({ message: \"Error while getting data from categories!\" })\n\t\t\t})\n\t\ttry {\n\t\t\tawait renderTopBooks()\n\t\t} catch {\n\t\t\tiziToast.error({ message: \"Error while getting books data!\" })\n\t\t}\n\t}, 1000)\n})\n\ncategoryBtn.addEventListener(\"click\", () => {\n\tcategories.classList.toggle(\"active\")\n})\n\ncategories.addEventListener(\"click\", async e => {\n\tif (\n\t\te.target === e.currentTarget ||\n\t\t!e.target ||\n\t\te.target.classList.contains(\"active\")\n\t) {\n\t\treturn\n\t}\n\tcategories\n\t\t.querySelectorAll(\"li.active\")\n\t\t.forEach(item => item.classList.remove(\"active\"))\n\te.target.classList.add(\"active\")\n\tconst category = e.target.textContent\n\tcategoryBtn.textContent = category\n\tcategories.classList.remove(\"active\")\n\trenderLoadingBooks()\n\thideLoadingMore()\n\tif (e.target.dataset.value === \"all\") {\n\t\tawait renderTopBooks()\n\t\treturn\n\t}\n\trenderedBooks = []\n\tpage = 0\n\tgetBooksByCategory(category)\n\t\t.then(data => {\n\t\t\trenderedBooks = data\n\t\t\trenderBooks(sliceFirstBooksByPage(data))\n\t\t\tpage += 1\n\t\t\tif (data.length > numberToPaginate()) {\n\t\t\t\tshowLoadingMore()\n\t\t\t}\n\t\t\tsetPaginationNumber(data, numberToPaginate())\n\t\t\tsetPaginationCount(data.length)\n\t\t})\n\t\t.catch(() => {\n\t\t\tiziToast.error({\n\t\t\t\tmessage: \"Error while getting data from category!\",\n\t\t\t})\n\t\t})\n\t\t.finally(() => removeRenderLoading(booksList))\n})\n\nmoreButton.addEventListener(\"click\", e => {\n\te.preventDefault()\n\tmoreButton.disabled = true\n\tconst alreadyShown = numberToPaginate() + page * paginationNumber\n\tconst remaining = renderedBooks.length - alreadyShown\n\tconsole.log(remaining)\n\tif (remaining > 0) {\n\t\tconst slice = sliceBooksByPage(renderedBooks, page)\n\t\trenderNewBooks(slice)\n\n\t\tpage++\n\n\t\tconst newShown = alreadyShown + slice.length\n\t\tsetPaginationNumber(renderedBooks, newShown)\n\n\t\tif (newShown >= renderedBooks.length) {\n\t\t\thideLoadingMore()\n\t\t\tiziToast.success({\n\t\t\t\tposition: \"bottomRight\",\n\t\t\t\tmessage: \"This is the last page of books for you :)\",\n\t\t\t\tcolor: \"#fff\",\n\t\t\t})\n\t\t}\n\n\t\tmoreButton.disabled = false\n\t} else {\n\t\tiziToast.error({\n\t\t\tmessage: \"You already loaded all books from that category!\",\n\t\t})\n\t}\n})\n\nbooksList.addEventListener(\"click\", async e => {\n\tif (e.target.nodeName != \"BUTTON\" || e.target.classList != \"btn\") {\n\t\treturn\n\t}\n\tawait loadBookModal(e.target.dataset.bookid)\n})\n"],"names":["books","refs","booksList","categoryBtn","categories","isMobile","numberToPaginate","paginationNumber","paginationNum","moreButton","paginationCount","showLoadingMore","hideLoadingMore","renderBooks","a","_id","book_image","title","price","author","renderNewBooks","sliceBooksByPage","page","sliceFirstBooksByPage","setPaginationNumber","value","setPaginationCount","renderLoadingBooks","_","renderLoadingTexts","element","i","removeRenderLoading","renderedBooks","renderTopBooks","getTopBooks","data","category","iziToast","getCategoryList","acc","list_name","item","getBooksByCategory","alreadyShown","remaining","slice","newShown","loadBookModal"],"mappings":"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"}